<!-- Meta -->
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="expires" content="0">
<meta name="description" content="<%= title %>">
<meta name="keywords" content="<%= settings.store_name %>, <%= settings.text_footer %>, <%= title %>">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- manifest -->
<link rel="manifest" href="/manifest.json">
<script>
    let deferredPrompt;

    // ลงทะเบียน Service Worker เมื่อโหลดหน้าเว็บ
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js').then((registration) => {
                console.log('Service Worker registered with scope:', registration.scope);
            }).catch((error) => {
                console.log('Service Worker registration failed:', error);
            });
        });
    }

    // จัดการเหตุการณ์ก่อนการติดตั้ง PWA
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault(); // ป้องกันการแสดงแถบติดตั้งเริ่มต้น
        deferredPrompt = e; // เก็บเหตุการณ์เพื่อเรียกใช้งานภายหลัง

        // ตรวจสอบว่า hostname ไม่ใช่ localhost และเรียกใช้ prompt ติดตั้งอัตโนมัติ
        if (window.location.hostname !== 'localhost') {
            promptInstallPWA();
        }
    });

    // ฟังก์ชันติดตั้ง PWA อัตโนมัติหรือเมื่อคลิกปุ่ม
    function promptInstallPWA() {
        if (deferredPrompt) {
            deferredPrompt.prompt(); // แสดง prompt
            deferredPrompt.userChoice.then((choiceResult) => {
                console.log(`User response to the install prompt: ${choiceResult.outcome}`);
                deferredPrompt = null; // รีเซ็ตค่า deferredPrompt
            });
        } else {
            console.log('Cannot prompt install; deferredPrompt is not available');
        }
    }

    // เรียกใช้ฟังก์ชัน promptInstallPWA เมื่อผู้ใช้คลิกปุ่ม
    document.getElementById('install_posms_app_button').addEventListener('click', (e) => {
        e.preventDefault();
        promptInstallPWA(); // เรียกใช้การติดตั้ง PWA เมื่อคลิกปุ่ม
    });

    // แจ้งเตือนเมื่อแอปติดตั้งเสร็จสิ้น
    window.addEventListener('appinstalled', () => {
        console.log('PWA has been installed');
    });

    // จัดการการคลิกปุ่มล้างแคช
    document.getElementById('clear_cache_button').addEventListener('click', () => {
        // ลบข้อมูลใน LocalStorage
        localStorage.clear();
        
        // ลบข้อมูลใน SessionStorage
        sessionStorage.clear();

        // ตรวจสอบว่ามี Service Worker หรือไม่
        if (navigator.serviceWorker && navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({ action: 'skipWaiting' });
        }

        // รีโหลดหน้าเว็บ
        location.reload();
    });
</script>
<!-- Title -->
<title><%= title %></title>
<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/images/logo/icons/logo-icon-latest-1.png?v=<%= sys_version %>">
<link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/images/logo/icons/logo-icon-latest-1.png?v=<%= sys_version %>">
<link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/images/logo/icons/logo-icon-latest-1.png?v=<%= sys_version %>">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/plugins/fontawesome-free/css/all.min.css?v=<%= sys_version %>">
<!-- overlayScrollbars -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/plugins/overlayScrollbars/css/OverlayScrollbars.min.css?v=<%= sys_version %>">
<!-- iCheck -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/plugins/icheck-bootstrap/icheck-bootstrap.min.css?v=<%= sys_version %>">
<!-- Theme style -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/dist/css/adminlte.min.css?v=<%= sys_version %>">
<!-- summernote -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/plugins/summernote/summernote-bs4.min.css?v=<%= sys_version %>">
<!-- Style main -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/newzydev/POSMS-NodeJS-Express-EJS-MySQL@main/Public/assets/css/style.css?v=<%= sys_version %>">